var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onResourceLoadComplete=function(e){if("preload"==e.groupName){this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this);var t=new fighter.GameContainer;this.addChild(t)}},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var fighter;!function(e){var t=function(t){function i(e,i,r){var s=t.call(this)||this;return s.fireDelay=i,s.blood=r,s.bmp=new egret.Bitmap(e),s.addChild(s.bmp),s.bmp.pixelHitTest=!0,s.fireTimer=new egret.Timer(s.fireDelay),s.fireTimer.addEventListener(egret.TimerEvent.TIMER,s.createBullet,s),s}return __extends(i,t),i.produce=function(t,i,r){null==e.Airplane.cacheDict[t]&&(e.Airplane.cacheDict[t]=[]);var s,h=e.Airplane.cacheDict[t];return s=h.length>0?h.pop():new e.Airplane(RES.getRes(t),i,r),s.blood=r,s},i.reclaim=function(t,i){null==e.Airplane.cacheDict[i]&&(e.Airplane.cacheDict[i]=[]);var r=e.Airplane.cacheDict[i];-1==r.indexOf(t)&&r.push(t)},i.prototype.createBullet=function(){this.dispatchEventWith("createBullet")},i.prototype.fire=function(){this.createBullet(),this.fireTimer.start()},i.prototype.stopFire=function(){this.fireTimer.stop()},i.cacheDict={},i}(egret.DisplayObjectContainer);e.Airplane=t,__reflect(t.prototype,"fighter.Airplane")}(fighter||(fighter={}));var fighter;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.speed=2,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var e=new egret.Bitmap(RES.getRes("bg_jpg"));this.textureHeight=e.height,this.rowCount=Math.ceil(this.stageH/this.textureHeight)+1,this.bmArr=[];for(var t=0,i=this.rowCount;i>t;t++){var r=new egret.Bitmap(RES.getRes("bg_jpg"));r.y=this.textureHeight*t-(this.textureHeight*this.rowCount-this.stageH),this.bmArr.push(r),this.addChild(r)}},t.prototype.start=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},t.prototype.enterFrameHandler=function(e){for(var t=0,i=this.bmArr.length;i>t;t++){var r=this.bmArr[t];r.y+=this.speed,r.y>=this.stageH&&(r.y=-(this.textureHeight*this.rowCount-this.stageH),this.bmArr.pop(),this.bmArr.unshift(r))}},t.prototype.pause=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},t}(egret.DisplayObjectContainer);e.BgMap=t,__reflect(t.prototype,"fighter.BgMap")}(fighter||(fighter={}));var fighter;!function(e){var t=function(e){function t(t,i,r){var s=e.call(this)||this;s.bloodW=t,s.bloodH=i,s.rectW=t,s.allBlood=r;var h=new egret.Shape;return h.graphics.beginFill(13421772),h.graphics.drawRoundRect(0,0,s.bloodW,s.bloodH,20,s.bloodH),h.graphics.endFill(),s.addChild(h),s.topBlood=new egret.Shape,s.topBlood.graphics.beginFill(16711680),s.topBlood.graphics.drawRoundRect(0,0,s.bloodW,s.bloodH,20,s.bloodH),s.topBlood.graphics.endFill(),s.addChild(s.topBlood),s.maskObject=new egret.Rectangle(0,0,s.rectW,s.bloodH),s.topBlood.mask=s.maskObject,s}return __extends(t,e),t.prototype.reduceBlood=function(e){this.rectW=e/this.allBlood*this.bloodW,this.maskObject.width=this.rectW,this.topBlood.mask=this.maskObject},t}(egret.Sprite);e.BloodStrip=t,__reflect(t.prototype,"fighter.BloodStrip")}(fighter||(fighter={}));var fighter;!function(e){var t=function(t){function i(e,i){return t.call(this,e)||this}return __extends(i,t),i.produce=function(t,i){null==e.Bullet.cacheDict[t]&&(e.Bullet.cacheDict[t]=[]);var r,s=e.Bullet.cacheDict[t];return r=s.length>0?s.pop():new e.Bullet(RES.getRes(t),i),r.textureName=t,r.pixelHitTest=!0,r.aggressivity=i,r},i.reclaim=function(t,i){null==e.Bullet.cacheDict[i]&&(e.Bullet.cacheDict[i]=[]);var r=e.Bullet.cacheDict[i];-1==r.indexOf(t)&&r.push(t)},i.cacheDict={},i}(egret.Bitmap);e.Bullet=t,__reflect(t.prototype,"fighter.Bullet")}(fighter||(fighter={}));var fighter;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.myBullets=[],e.myBulletAgg=2,e.myBlood=10,e.enemyFighters=[],e.enemyBlood=10,e.enemyBullets=[],e.enemyBulletAgg=1,e.enemyCreateBulletTime=2e3,e.enemyFightersTimer=new egret.Timer(1500),e.isLOrR=!0,e.speed=1,e.lastTime=egret.getTimer(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(i,t),i.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.createGameScene()},i.prototype.createGameScene=function(){this.bg=new e.BgMap,this.addChild(this.bg),this.btnStart=new egret.Bitmap,this.btnStart.texture=RES.getRes("btn_start_png"),this.addChild(this.btnStart),this.btnStart.x=this.stage.stageWidth/2-this.btnStart.width/2,this.btnStart.y=this.stage.stageHeight/2-this.btnStart.height/2,this.btnStart.touchEnabled=!0,this.myFighter=new e.Airplane(RES.getRes("f1_png"),100,this.myBlood),this.addChild(this.myFighter),this.myFighter.x=(this.stage.stageWidth-this.myFighter.width)/2,this.myFighter.y=this.stage.stageHeight-this.myFighter.height-50,this.myFighterBlood=new e.BloodStrip(300,20,10),this.myFighterBlood.x=20,this.myFighterBlood.y=this.stage.stageHeight-this.myFighterBlood.height-10,this.addChild(this.myFighterBlood),this.btnStart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gameStart,this)},i.prototype.gameStart=function(){this.contains(this.showScore)&&this.removeChild(this.showScore),this.myScore=0,this.contains(this.again)&&(this.removeChild(this.again),this.again.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.gameStart,this)),this.bg.start(),this.contains(this.btnStart)&&(this.removeChild(this.btnStart),this.btnStart.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.gameStart,this)),this.myFighter.blood<=0&&(this.myFighter.blood=this.myBlood),this.myFighter.x=(this.stage.stageWidth-this.myFighter.width)/2,this.myFighter.y=this.stage.stageHeight-this.myFighter.height-50,this.myFighterBlood.reduceBlood(this.myFighter.blood),this.myFighter.fire(),this.myFighter.addEventListener("createBullet",this.createBulletHandle,this),this.enemyFightersTimer.addEventListener(egret.TimerEvent.TIMER,this.createEnemyFighter,this),this.enemyFightersTimer.start(),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandle,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.myFighterMove,this)},i.prototype.createEnemyFighter=function(){var t=e.Airplane.produce("f2_png",this.enemyCreateBulletTime,this.enemyBlood);t.x=Math.random()*(this.stage.stageWidth-t.width),t.y=-t.height,t.fire(),this.addChildAt(t,this.numChildren-1),this.enemyFighters.push(t),t.addEventListener("createBullet",this.createBulletHandle,this)},i.prototype.createBulletHandle=function(t){var i,r=t.target;r==this.myFighter?(i=e.Bullet.produce("b1_png",this.myBulletAgg),i.x=this.isLOrR?this.myFighter.x+(this.myFighter.width/2-i.width)/2:this.myFighter.x+(this.myFighter.width/2-i.width)/2+this.myFighter.width/2,i.y=this.myFighter.y+(this.myFighter.height-i.height)/2,this.isLOrR=!this.isLOrR,this.myBullets.push(i),this.addChildAt(i,this.numChildren-1-this.enemyBullets.length-1)):(i=e.Bullet.produce("b2_png",this.myBulletAgg),i.x=r.x+(r.width-i.width)/2,i.y=r.y+(r.height-i.height)/2,this.enemyBullets.push(i),this.addChildAt(i,this.numChildren-1-this.enemyBullets.length-1))},i.prototype.enterFrameHandle=function(t){var i=egret.getTimer(),r=1e3/(i-this.lastTime);this.speed=60/r,this.lastTime=i;for(var s=0;s<this.myBullets.length;s++){var h=this.myBullets[s];h.y-=6*this.speed,h.y<=0&&(e.Bullet.reclaim(h,"b1_png"),this.removeChild(h),this.myBullets.splice(s,1),s--)}for(var s=0;s<this.enemyFighters.length;s++){var n=this.enemyFighters[s];n.y+=2*this.speed,n.y>=this.stage.stageHeight&&(e.Airplane.reclaim(n,"f2_png"),this.removeChild(n),this.enemyFighters.splice(s,1),s--)}for(var s=0;s<this.enemyBullets.length;s++){var o=this.enemyBullets[s];o.y+=4*this.speed,o.y>=this.stage.stageHeight&&(e.Bullet.reclaim(o,"b2_png"),this.removeChild(o),this.enemyBullets.splice(s,1),s--)}this.gameHitTest()},i.prototype.myFighterMove=function(e){this.myFighter.x=e.stageX-this.myFighter.width/2},i.prototype.gameHitTest=function(){for(var t=[],i=[],r=0;r<this.myBullets.length;r++)for(var s=this.myBullets[r],h=0;h<this.enemyFighters.length;h++){var n=this.enemyFighters[h];e.GameUtil.hitText(s,n)&&(n.blood-=this.myBulletAgg,-1==t.indexOf(s)&&t.push(s),n.blood<=0&&-1==i.indexOf(n)&&(i.push(n),this.myScore++))}for(var r=0;r<this.enemyBullets.length;r++){var o=this.enemyBullets[r],a=this.myFighter;e.GameUtil.hitText(o,a)&&(a.blood-=this.enemyBulletAgg,this.myFighterBlood.reduceBlood(a.blood),-1==t.indexOf(o)&&t.push(o))}for(var r=0;r<this.enemyFighters.length;r++){var n=this.enemyFighters[r];e.GameUtil.hitText(n,this.myFighter)&&(this.myFighter.blood=0,this.myFighterBlood.reduceBlood(this.myFighter.blood))}if(this.myFighter.blood<=0)this.gameStop();else{for(;t.length>0;){var l=t.pop();this.removeChild(l),e.Bullet.reclaim(l,l.textureName),"b1_png"==l.textureName?this.myBullets.splice(this.myBullets.indexOf(l),1):this.enemyBullets.splice(this.enemyBullets.indexOf(l),1)}for(;i.length>0;){var g=i.pop();this.removeChild(g),g.stopFire(),g.removeEventListener("createBullet",this.createBulletHandle,this),e.Airplane.reclaim(g,"f2_png"),this.enemyFighters.splice(this.enemyFighters.indexOf(g),1)}}},i.prototype.gameStop=function(){this.bg.pause(),this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandle,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.myFighterMove,this),this.myFighter.removeEventListener("createBullet",this.createBulletHandle,this),this.enemyFightersTimer.removeEventListener(egret.TimerEvent.TIMER,this.createEnemyFighter,this),this.enemyFightersTimer.stop(),this.myFighter.stopFire();for(var t;this.myBullets.length>0;)t=this.myBullets.pop(),this.removeChild(t),e.Bullet.reclaim(t,"b1_png");for(;this.enemyBullets.length>0;)t=this.enemyBullets.pop(),this.removeChild(t),e.Bullet.reclaim(t,"b2_png");for(var i;this.enemyFighters.length>0;)i=this.enemyFighters.pop(),i.stopFire(),i.removeEventListener("createBullet",this.createBulletHandle,this),this.removeChild(i),e.Airplane.reclaim(i,"f2_png");this.showScore=new e.ScorePanel,this.addChild(this.showScore),this.showScore.x=(this.stage.stageWidth-this.showScore.width)/2,this.showScore.y=150,this.showScore.showType(this.myScore),this.again=new egret.Bitmap,this.again.texture=RES.getRes("again_png"),this.addChild(this.again),this.again.x=this.stage.stageWidth/2-this.again.width/2,this.again.y=this.stage.stageHeight/2-this.again.height/2,this.again.touchEnabled=!0,this.again.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gameStart,this)},i}(egret.DisplayObjectContainer);e.GameContainer=t,__reflect(t.prototype,"fighter.GameContainer")}(fighter||(fighter={}));var fighter;!function(e){var t=function(e){function t(){var t=e.call(this)||this,i=new egret.Bitmap(RES.getRes("show_score_box_png"));t.addChild(i);var r=new egret.Bitmap(RES.getRes("gameover_png"));return t.addChild(r),r.scaleX=.5,r.scaleY=.4,r.x=(i.width-r.width*r.scaleX)/2,r.y=30,t.tx=new egret.TextField,t.tx.width=i.width,t.tx.height=i.height,t.tx.size=24,t.tx.textAlign="center",t.tx.y=80,t.tx.lineSpacing=6,t.addChild(t.tx),t}return __extends(t,e),t.prototype.showType=function(e){this.tx.text="您当前的分数是\n"+e+"\n重来一局？"},t}(egret.DisplayObjectContainer);e.ScorePanel=t,__reflect(t.prototype,"fighter.ScorePanel")}(fighter||(fighter={}));var fighter;!function(e){var t=function(){function e(){}return e.hitText=function(e,t){var i=e.getBounds(),r=t.getBounds();return i.x=e.x,i.y=e.y,r.x=t.x,r.y=t.y,i.intersects(r)},e}();e.GameUtil=t,__reflect(t.prototype,"fighter.GameUtil")}(fighter||(fighter={}));